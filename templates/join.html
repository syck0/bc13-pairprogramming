<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>{ } Code.ing</title>

    <meta charset="utf-8" />
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>

    <!-- CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/3.24.0/codemirror.min.js"></script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/3.24.0/codemirror.min.css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/3.24.0/mode/python/python.js"></script>

    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/main.css" rel="stylesheet">

      <script src="../static/js/jquery-3.1.1.min.js"></script>


  </head>
  <body>

        <nav class="navbar-inverse navbar-default">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand logo" href="#">
                { } Code.ing
              </a>
            </div>


          </div>
        </nav>


      <div class="container" id="content">
          <div class="page-header">
            <h1 class="page-title">{ } Code.ing <small>Welcome to pair programming</small></h1>
          </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <p>Your Pair programming session is: {{ session_id}}</p>
            </div>
            <div class="panel-body" id="code">

                <script type="text/javascript">
                    function updateData(doc , line, text){
                        line = parseInt(line);
                        if (text == undefined){
                                    text="";
                                }
                        if (doc.getLine(line+1)== undefined){
                                    text=text+"\n";
                                }

                              doc.setLine(parseInt(line),text);
                    }
                    function init() {

                        var editor = CodeMirror(document.getElementById("code"), {
                                          lineNumbers: true,
                                          extraKeys: {"Ctrl-Space": "autocomplete"},
                                          readOnly:true,
                                          mode: {
                                              name: "python"
                                          }
                                        });

                        var config =
                        {
                            apiKey: "AIzaSyC3juQWlZkickBDwDtFnuyOTWCIt6U4fzs",
                            authDomain: "code-ing.firebaseapp.com",
                            databaseURL: "https://code-ing.firebaseio.com",
                            storageBucket: "code-ing.appspot.com",
                            messagingSenderId: "441078050477"
                        };
                        firebase.initializeApp(config);

                            var doc=editor.getDoc();
                        console.log('{{session_id}}');

                            var codeRef = firebase.database().ref('users/' + '{{session_id}}');



                            codeRef.on('child_added', function(data)
                            {
                                var line=data['key'];
                                var text=data.val()['text'];
                                updateData(doc,line,text);
                          });

                          codeRef.on('child_changed', function(data)
                          {
                            var line=data['key'];
                            var text=data.val()['text'];
                            updateData(doc,line,text);


                          });

                          codeRef.on('child_removed', function(data)
                          {
                            doc.removeLine(data['key']);
                          });




                          // Keep track of all Firebase references on which we are listening.

                        }


                    window.onload = function(){
                        init();
                    };



                </script>

            </div>
        </div>
            </div>
          </div>




      <footer class="container-fluid text-center">
          <a href="#myPage" title="To Top">
            <span class="logo">{ } Code.ing</span>
          </a>
          <p>Powered by <a href="#" title="">Andela</a></p>
      </footer>
  </body>
</html>